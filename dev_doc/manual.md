# はじめに

### 本システムについて
本システムはクラウド上の各VMを管理、操作する為のシステムとなる。

### 目次
##### [①一般ユーザ向け操作マニュアル](#1)
##### [②管理者ユーザ向け操作マニュアル](#2)
##### [③システム担当者向けマニュアル](#3)

<a name="1"></a>
# ①一般ユーザ向け操作マニュアル
### ユーザVM管理画面
一般ユーザがログインした直後の画面となる。  
■仮想マシン一覧  
ログインしている自ユーザが所有するVMの一覧を表示。各表示項目については以下を参照。
###### 表示項目説明
|項目名|説明|
|---|---|
|Status※画像|VMの稼働状況。実行中の場合元気なPCの表示、停止中の場合元気がないPCの表示となる|
|GuestName|VMの名称|
|Os|VMのOS種類|
|LoginUser|VMのrootユーザのユーザ名※GuestOsAuthBrowse権限が無い場合マスクされて表示|
|Password|VMのrootユーザのパスワード※GuestOsAuthBrowse権限が無い場合マスクされて表示|
|Ip|VMに紐づいているグローバルIP。直接VM内で設定しているか、上位ネットワークでNATしている場合がある|
|Port|VMへリモートデスクトップまたはsshで接続する為のポート|
|Remarks|VMに関する説明、備考など|

■最近のログ  
ログインしている自ユーザの操作内容を表示。（最新のものから20件まで）  
■info  
お知らせ情報を表示。  
■ログアウトボタン  
セッションを破棄し、ログイン画面へ戻る。
### 各ボタン
■Start※GuestOsStart権限が必要  
対象のVMを起動する。すでに起動している場合はボタンが非活性となる。  
■Stop※GuestOsStop権限が必要  
対象のVMを停止する。すでに停止している場合はボタンが非活性となる。     
※このメニューは、物理マシンで例えると、シャットダウンではなく電源を切る動作に該当する為、VMを落としたい場合は、基本的にはVM内でシャットダウンを実行する形を推奨。VMがハングアップした場合などに使用することを目的とした機能となる。  
■Detail  
対象のVMの詳細を開く。（本資料の「ユーザ向けモーダル」を参照）

### ユーザ向けモーダル
「仮想マシン一覧」に表示されている項目に加え、以下を表示する。  
###### 表示項目説明
|項目名|説明|
|---|---|
|GuestOsHostName|VM内で使用しているホスト名|
|LanIp|VM内で使用しているローカルIP|
|Cpu|VMに割り当てられているVCPU数|
|Mem|VMに割り当てられているメモリ（GB）|
|Disk|VMに割り当てられているディスク（GB）|

### ユーザ向け各権限の説明
※権限は管理者ユーザのみが変更可能となる  

|項目名|説明|
|---|---|
|GuestOsAuthBrowse|ゲストOSにログインするユーザ名、パスワードが閲覧可能となる|
|GuestOsStart|ゲストOSを起動することが可能となる|
|GuestOsStop|ゲストOSを停止することが可能となる|

<a name="2"></a>
# ②管理者ユーザ向け操作マニュアル
## 共通ヘッダー項目
■ゲストOS一覧ボタン  
ゲストOS一覧画面に遷移する  
■ホストOS一覧ボタン  
ホストOS一覧画面に遷移する  
■ユーザ一覧ボタン  
ユーザ一覧画面に遷移する  
■ログ一覧ボタン  
ログ一覧画面に遷移する  
■ログアウトボタン  
セッションを破棄し、ログイン画面へ戻る

## ゲストOS一覧画面
管理者ユーザがログインした直後の画面となる。
#### 画面項目
■仮想マシン一覧  
全てのVMの一覧を表示。ゲストOS情報を直接取得していないものは変更可能。各表示項目については以下を参照。
###### 表示項目説明
|項目名|説明|変更可否|
|---|---|---|
|GuestName|VMの名称|不可|
|Status|VMの稼働状況。実行中またはシャットオフのどちらか|不可|
|Os|VMのOS種類|可|
|Cpu|VMに割り当てられているVCPU数|不可|
|Mem|VMに割り当てられているメモリ（GB）|不可|
|Disk|VMに割り当てられているディスク（GB）|不可|
|Ip|VMに紐づいているグローバルIP。直接VM内で設定しているか、上位ネットワークでNATしている場合がある|可|
|Port|VMへリモートデスクトップまたはsshで接続する為のポート|可|
|Remarks|VMに関する説明、備考など|可|

■最新の状態に更新ボタン※GuestOsAllGet権限が必要  
DBに登録されているすべてのホストOSに対し、そのホストOS上に存在するすべてのVM情報を取得し、仮想マシン一覧に表示されている情報を更新する。
更新される対象は以下となる。  
（更新項目）  
・GuestName  
・Status  
・Cpu  
・Mem  
・Disk  
なお、新規登録の場合は、VMの所有ユーザはシステムユーザとなり、上記以外の項目はすべてブランクで登録される。  
■最近のログ  
全てのユーザの操作内容を表示。（最新のものから20件まで）  
■info  
お知らせ情報を表示。  

#### 右クリックメニュー
仮想マシン一覧内のセルを右クリックすることで、各操作を実行する。  
※複数セルを選択した場合、起点となったセルが対象となる。  
■UserCheck  
対象のVMを所有するユーザの、ユーザVM管理画面を開く。（本資料の「ユーザVM管理画面」を参照）  
■HostOsCheck  
対象のVMを稼働しているホストOSの、ホストOS一覧画面を開く。（本資料の「ホストOS一覧画面」を参照）  
■Update※GuestOsUpdate権限が必要  
対象のVMの情報を画面上にて編集した情報で更新する。更新不可能な項目について、画面上で編集し更新を実行してもDBへは更新されない。（更新可能な項目については本資料「ゲストOS一覧画面」の「表示項目説明」を参照）  
■UserChange※GuestOsUpdate権限が必要    
対象のVMの所有ユーザを変更する為のメニューを表示。（本資料の「管理者向けユーザ変更モーダル」を参照）   
■Detail  
対象のVMの詳細を開く。（本資料の「管理者向けVM詳細モーダル」を参照）

#### 管理者向けユーザ変更モーダル
VMとユーザの紐づけを行い、ユーザが所有するVMを変更する。  
###### 表示項目説明
|項目名|説明|
|---|---|
|NewUser|変更し新たにVMの所有者となる対象のユーザ。リストボックス内で選択し、「ユーザ更新」を押下することで変更が完了となる|
|UserSearch|各項目に値を入れ、「検索」ボタンを押下することでリストボックスの中身が絞り込まれる。複数入力時はAND検索となる。各項目の説明に関しては、本資料の「ユーザ一覧画面、表示項目説明」を参照。|

#### 管理者向けVM詳細モーダル
「仮想マシン一覧」に表示されている項目に加え、以下を表示し、編集可能な項目は更新を実行する。  
###### 表示項目説明
|項目名|説明|変更可否|
|---|---|---|
|GuestOsHostName|VM内で使用しているホスト名|可|
|LanIp|VM内で使用しているローカルIP|可|
|VlanId|VMの所属するVLANのID（ローカルエリア通信を実行する時のみ）|可|
|LoginUser|VMの管理者ユーザのユーザID※GuestOsAuthBrowse権限が無い場合マスクされて表示|可|
|LoginPassword|VMの管理者ユーザのパスワード※DBには可逆暗号で格納※GuestOsAuthBrowse権限が無い場合マスクされて表示|可|
|Kanshi|VMが監視システムにより監視されているかどうか|可|

## ホストOS一覧画面
#### 画面項目
■物理マシン一覧  
VMが稼働している全てのホストOSの一覧を表示。ゲストOS情報を直接取得していないものは変更可能。各表示項目については以下を参照。
###### 表示項目説明
|項目名|説明|変更可否|
|---|---|---|
|HostName|ホストOSのホスト名|可|
|Ip|ホストOSのIP。※このシステムが接続する対象のIPアドレス|可|
|Cpu|ホストOSのCPU（スレッド）|可|
|Mem|ホストOSのメモリ（GB）|可|
|Disk|ホストOSのディスク（GB）※VMが稼働する領域のディスク領域|可|
|UseCpu|各VMがそのホストOS上で使用している合計のCPU数※オーバーコミットでホストOSの合計値を超える場合有り|不可|
|UseMem|各VMがそのホストOS上で使用している合計のメモリ容量※オーバーコミットでホストOSの合計値を超える場合有り|不可|
|UseDisk|各VMがそのホストOS上で使用している合計のディスク容量※オーバーコミットでホストOSの合計値を超える場合有り|不可|
|Cpu%|各VMがそのホストOS上で使用している合計のCPU数（使用割合）※オーバーコミットで100%を超える場合有り|不可|
|Mem%|各VMがそのホストOS上で使用している合計のメモリ容量（使用割合）※オーバーコミットで100%を超える場合有り|不可|
|Disk%|各VMがそのホストOS上で使用している合計のディスク容量（使用割合）※オーバーコミットで100%を超える場合有り|不可|
|Remarks|ホストOSに関する説明、備考など|可|

■最近のログ  
全てのユーザの操作内容を表示。（最新のものから20件まで）  
■info  
お知らせ情報を表示。  
#### 右クリックメニュー
物理マシン一覧内のセルを右クリックすることで、各操作を実行する。  
※複数セルを選択した場合、起点となったセルが対象となる。  
■GuestOsCheck  
対象のホストOS上で稼働しているVMの、ゲストOS一覧画面を開く。（本資料の「ゲストOS一覧画面」を参照）  
■Update※HostOsUpdate権限が必要  
対象のホストOSの情報を画面上にて編集した情報で更新する。更新不可能な項目について、画面上で編集し更新を実行してもDBへは更新されない。（更新可能な項目については本資料「ホストOS一覧画面」の「表示項目説明」を参照）   

## ユーザ一覧画面
#### 画面項目
■ユーザ一覧  
本システムを使用するユーザの一覧を表示。各表示項目と編集可能項目については以下を参照。
###### 表示項目説明
|項目名|説明|変更可否|
|---|---|---|
|UserName|ユーザ名|可|
|LoginId|ユーザのログインID※UserAuthBrowse権限が無い場合マスクされて表示|可|
|Password|ユーザのパスワード※DBには可逆暗号で格納※UserAuthBrowse権限が無い場合マスクされて表示|可|
|lastlogin|ユーザの最終ログイン日時を表示|不可|
|Remarks|ユーザに関する説明、備考など|可|

■ユーザを追加ボタン※UserCreate権限が必要  
ユーザ追加メニューを表示（本資料の「管理者向けユーザ追加モーダル」を参照）  
■最近のログ  
全てのユーザの操作内容を表示。（最新のものから20件まで）  
■info  
お知らせ情報を表示。  

#### 管理者向けユーザ追加モーダル
各項目に値を入力し、「追加」ボタンを押下することで、ユーザの追加が行われる。各項目の説明に関しては、本資料の「ユーザ一覧画面、表示項目説明」を参照。  

#### 右クリックメニュー
物理マシン一覧内のセルを右クリックすることで、各操作を実行する。  
※複数セルを選択した場合、起点となったセルが対象となる。  
■GuestOsCheck  
対象のホストOS上で稼働しているVMの、ゲストOS一覧画面を開く。（本資料の「ゲストOS一覧画面」を参照）  
■Update※UserUpdate権限が必要  
対象のホストOSの情報を画面上にて編集した情報で更新する。更新不可能な項目について、画面上で編集し更新を実行してもDBへは更新されない。（更新可能な項目については本資料「ホストOS一覧画面」の「表示項目説明」を参照）  
■Detail  
対象のユーザの詳細を開く。（本資料の「管理者向けユーザ詳細モーダル」を参照）

#### 管理者向けユーザ詳細モーダル
「ユーザ一覧」に表示されている項目に加え、以下を表示し、編集可能な項目は更新を実行する。  
###### 表示項目説明
|項目名|説明|変更可否|
|---|---|---|
|AdminFlag|チェック有で管理者ユーザとなる|可|
|UserCreate|チェック有でユーザを作成することが可能となる|可|
|UserUpdate|チェック有でユーザを更新することが可能となる|可|
|UserDelete|チェック有でユーザを削除することが可能となる|可|
|UserAuthBrowse|チェック有でユーザのログインID、パスワードが閲覧、変更可能となる|可|
|GuestOsUpdate|チェック有でゲストOSを更新することが可能となる|可|
|GuestOsAllGet|チェック有でゲストOSの最新情報を取得することが可能となる|可|
|GuestOsAuthBrowse|チェック有でゲストOSにログインするユーザ名、パスワードが閲覧、変更可能となる|可|
|GuestOsStart|チェック有でゲストOSを起動することが可能となる|可|
|GuestOsStop|チェック有でゲストOSを停止することが可能となる|可|
|HostOsCreate|チェック有でホストOSを作成することが可能となる|可|
|HostOsUpdate|チェック有でホストOSを更新することが可能となる|可|
|HostOsDelete|チェック有でホストOSを削除することが可能となる|可|

## ログ一覧画面
全てのログを表示。多くなるとDB負荷かかりそうなので条件検索とかでフィルタするようにいつかやる。

<a name="3"></a>
# ③システム担当者向けマニュアル
## 課題とシステム化の目的
###### 課題
1. VMが起動していない、ログインできない場合のVMの操作について、基本的には管理者が物理ホストにアクセスし各種操作を実行することとなる。その為、VMの使用者がVMの起動や状態確認などを行うことができない。
1. 規模が大きくなると各物理ホストに存在するVMの情報や、リソース使用状況、IPアドレスの使用状況など、ドキュメントで管理することが手間であり、かつ、正確性が欠ける。

###### システム化による課題の解決
1. VM使用者にVMの操作、状態、各種情報確認ができるインターフェスを提供する。
1. 管理者向け機能として、自動で各ホストにあるVMの情報を取得し、ホストのリソース状況を計算や残り使用可能IPの数など、サマリ情報として表示させる。

## システム概要
1. VM使用ユーザに自身の保持するVM情報をweb画面にて表示させ、web画面より起動、停止などの操作を実行させる。
1. それぞれのユーザごとにアカウントを作り、web画面へのアクセス時にIDとパスワードで認証をさせる
1. ユーザのログイン及び操作はログ情報として記録する。  
1. ユーザは一般ユーザと管理者ユーザの2種類存在させ、かつユーザごとに各操作の権限を設定させ、機能を制限させる。  
1. 管理者ユーザは、一般ユーザの機能に加え、以下の機能を使用可能とする。  
 1. ゲストOSの一覧表示、データ取得、更新  
 1. ホストOSの一覧表示、更新、削除
 1. ログの一覧表示
 1. ユーザの一覧表示、作成、更新、削除
1. ユーザにweb画面を提供するwebサーバと、各VMが乗っているホストにてVM操作を行うエージェントを実装する。詳細は以下システム構成図を参照。

###### システム構成図
![構成図](./systemkousei.jpg)

## その他詳細について
開発やインフラ構築に関する詳細なドキュメントについては機密情報な為、別ドキュメントでの管理とする。
